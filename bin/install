#!/usr/bin/env bash

install_golang () {
    local install_type=$1
    local version=$2
    local install_path=$3
    local platform=""
    local arch=""
    local tempdir=""

    [ "Linux" = "$(uname)" ] && platform="linux" || platform="darwin"
    local uname_platform="$(uname)"
    case "$uname_platform" in
        Linux) platform="linux";;
        Darwin) platform="darwin";;
        *) echo "Platform not supported: $uname_platform" && exit 1
    esac

    case "$(uname -m)" in
        amd64) arch="amd64";;
        i386) arch="386";;
        i686) arch="386";;
        armv6l) arch="armv6l";;
        armv7l) arch="armv6l";;
        *) echo "Unknown architecture: $(uname -m)" && exit 1 
    esac    

    [ "linux" = "${platform}" ] && tempdir=$(mktemp -d asdf-golang.XXXXXX) || tempdir=$(mktemp -dt asdf-golang)

    curl "https://storage.googleapis.com/golang/go${version}.${platform}-${arch}.tar.gz" -o "${tempdir}/archive.tar.gz"

    tar -C "$install_path" -xzf "${tempdir}/archive.tar.gz"

    rm -rf "${tempdir}"
}

install_golang $ASDF_INSTALL_TYPE $ASDF_INSTALL_VERSION $ASDF_INSTALL_PATH
